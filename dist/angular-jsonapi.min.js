!function(){"use strict";angular.module("angular-jsonapi",["uuid4"]).constant("pluralize",pluralize).constant("validateJS",validate)}(),function(){"use strict";function n(n){function e(n){return new t(n)}function t(n){var e=this;e.resource=n,e.data={},e.removed={},e.size=0,e.indexIds=void 0}function r(e,t,r){var a=this,o=e.id;return void 0===o?void n.error("Can't add data without id!",e):(void 0===a.data[o]?(a.data[o]=a.resource.modelFactory(e,t,r),a.size+=1):a.data[o].update(e,!t["new"],t.initialization),a.data[o])}function a(n){var e=this,t=angular.fromJson(n),r={"new":!1,"synchronized":!1,stable:!1,pristine:!1,initialization:!0};angular.isObject(t)&&void 0!==t.data&&(e.updatedAt=t.updatedAt,e.indexIds=t.indexIds,angular.forEach(t.data,function(n){var t=n.data;e.addOrUpdate(t,r,n.updatedAt)}))}function o(){var n=this,e={data:[],updatedAt:n.updatedAt,indexIds:n.indexIds};return angular.forEach(n.data,function(n){n.hasErrors()===!1&&e.data.push(n.toJson())}),angular.toJson(e)}function i(){var n=this;n.indexIds=void 0,n.data={},n.removed={}}function s(n){var e=this,t={id:n,type:e.resource.schema.type},r={"new":!1,"synchronized":!1,stable:!1,pristine:!0};return void 0===e.data[n]&&(e.data[n]=e.resource.modelFactory(t,r)),e.data[n]}function c(e){var t=this;return n.debug("Unused params",e),void 0===t.indexIds?t.indexIds:t.indexIds.map(t.get.bind(t))}function u(n){var e=this;e.indexIds=[],angular.forEach(n,function(n){angular.isString(n)?e.indexIds.push(n):angular.isObject(n)&&angular.isString(n.data.id)&&e.indexIds.push(n.data.id)})}function l(n){var e=this;return void 0!==e.data[n]&&(e.removed[n]=e.data[n],delete e.data[n],e.size-=1),e.removed[n]}function d(n){var e=this;return void 0!==e.removed[n]&&(e.data[n]=e.removed[n],delete e.removed[n],e.size+=1),e.data[n]}function h(n){var e=this;delete e.removed[n]}return t.prototype.get=s,t.prototype.index=c,t.prototype.setIndexIds=u,t.prototype.addOrUpdate=r,t.prototype.fromJson=a,t.prototype.toJson=o,t.prototype.clear=i,t.prototype.remove=l,t.prototype.revertRemove=d,t.prototype.clearRemoved=h,{create:e}}angular.module("angular-jsonapi").factory("AngularJsonAPIResourceCache",n),n.$inject=["$log"]}(),function(){"use strict";function n(n){function e(n){return null===n?null:{type:n.data.type,id:n.data.id}}function t(e,t,r,i){var u;return void 0===e?(n.error("Can't add link to non existing object",e,t,r),n.error("Object:",e.data.type,e),n.error("Target:",r.data.type,r),n.error("Key:",t),[]):(u=e.schema.relationships[t],void 0===r?(n.error("Can't link non existing object",e,t,r,u),n.error("Object:",e.data.type,e),n.error("Target:",r.data.type,r),n.error("Key:",t),n.error("Schema:",u),[]):void 0===u?(n.error("Can't add link not present in schema:",e,t,r,u),n.error("Object:",e.data.type,e),n.error("Target:",r.data.type,r),n.error("Key:",t),n.error("Schema:",u),[]):null!==r&&u.polymorphic===!1&&u.model!==r.data.type?(n.error("This relation is not polymorphic, expected: "+u.model+" instead of "+r.data.type),n.error("Object:",e.data.type,e),n.error("Target:",r.data.type,r),n.error("Key:",t),n.error("Schema:",u),[]):"hasMany"===u.type?i===!0?(c(e,t,r,!1),[]):a(e,t,r):"hasOne"===u.type?i===!0?(s(e,t,r,!1),[]):o(e,t,r):void 0)}function r(e,t,r,a){var o;return void 0===e?(n.error("Can't remove link from non existing object",e,t,r),n.error("Object:",e.data.type,e),n.error("Target:",r.data.type,r),n.error("Key:",t),[]):(o=e.schema.relationships[t],void 0===o?(n.error("Can't remove link not present in schema:",e,t,r,o),n.error("Object:",e.data.type,e),n.error("Target:",r.data.type,r),n.error("Key:",t),n.error("Schema:",o),[]):a===!0?(l(e,t,r,!1),[]):i(e,t,r))}function a(n,e,t){var r,a=n.schema.relationships[e].reflection;return a===!1?(c(n,e,t),[]):(r=t.schema.relationships[a],"hasOne"===r.type?h(d(n,e,t),d(t,a,n),o(t,a,n)):"hasMany"===r.type?(c(n,e,t),c(t,a,n),[d(t,a,n)]):void 0)}function o(n,e,t){var r,a,o=n.schema.relationships[e].reflection,i=n.relationships[e],h=[];return s(n,e,t),void 0!==i&&null!==i&&(a=i.schema.relationships[o],"hasOne"===a.type?u(i,o,n):"hasMany"===a.type&&l(i,o,n),h.push(d(i,o,n))),void 0!==t&&null!==t&&o!==!1&&(r=t.schema.relationships[o],"hasOne"===r.type?s(t,o,n):"hasMany"===r.type&&c(t,o,n),h.push(d(t,o,n))),h}function i(n,e,t){var r,a=n.schema.relationships[e],o=a.reflection;return"hasMany"===a.type?l(n,e,t):"hasOne"===a.type&&u(n,e,t),o===!1?[]:(r=t.schema.relationships[o],"hasOne"===r.type?u(t,o,n):"hasMany"===r.type&&l(t,o,n),[d(t,o,n)])}function s(t,r,a,o){return n.debug("addHasOne",t,r,a),t.relationships[r]=a,t.data.relationships[r].data=e(a),o!==!1&&t.reset(!0),!0}function c(t,r,a,o){var i=e(a);return n.debug("addHasMany",t,r,a),angular.isArray(t.relationships[r])&&t.relationships[r].indexOf(a)>-1?!1:(t.relationships[r]=t.relationships[r]||[],t.data.relationships[r].data=t.data.relationships[r].data||[],t.relationships[r].push(a),t.data.relationships[r].data.push(i),o!==!1&&t.reset(!0),!0)}function u(e,t,r,a){return n.debug("removeHasOne",e,t,r),void 0!==r&&e.relationships[t]!==r?!1:(e.relationships[t]=null,e.data.relationships[t].data=void 0,a!==!1&&e.reset(!0),!0)}function l(e,t,r,a){if(n.debug("removeHasMany",e,t,r),void 0!==e.relationships[t]){if(void 0===r)return e.relationships[t]=[],e.data.relationships[t].data=[],a!==!1&&e.reset(!0),!0;var o=e.relationships[t].indexOf(r);return-1===o?!1:(e.relationships[t].splice(o,1),e.data.relationships[t].data.splice(o,1),a!==!1&&e.reset(!0),!0)}}function d(n,e,t){return{object:n,key:e,target:t}}function h(n,e,t){var r=-1;return angular.forEach(t,function(e,t){e.object===n.object&&e.key===n.key&&e.target===n.target&&(r=t)}),r>-1?t[r]=e:t.push(e),t}var p=this;return p.toLinkData=e,p.link=t,p.unlink=r,this}angular.module("angular-jsonapi").service("AngularJsonAPIModelLinkerService",n),n.$inject=["$log"]}(),function(){"use strict";function n(n,e,t,r){function a(n){return new o(n)}function o(n){var e=this;e.data={id:n.data.id,type:n.data.type,attributes:{},relationships:{}},e.relationships={},e.parent=n,e.schema=n.schema,e.reset()}function i(){var n=this,e=angular.copy(n.data),t={};return angular.forEach(e.relationships,function(n,e){void 0!==n.data&&(t[e]=n)}),e.relationships=t,{data:e}}function s(){var n=this;return n.parent.save()}function c(n){var e=this;angular.forEach(e.schema.relationships,function(n,t){e.data.relationships[t]=angular.copy(e.parent.data.relationships[t])||{},angular.isArray(e.relationships[t])?e.relationships[t]=e.parent.relationships[t].slice():e.relationships[t]=e.parent.relationships[t]}),(n!==!0||e.parent["synchronized"]!==!0)&&(angular.forEach(e.schema.attributes,function(n,t){e.data.attributes[t]=angular.copy(e.parent.data.attributes[t])}),e.parent.errors.validation.clear())}function u(e){function a(){void 0===e?c.parent.errors.validation.clear():c.parent.errors.validation.clear(e),u.resolve()}function o(t){c.parent.error=!0,void 0===e?c.parent.errors.validation.clear():c.parent.errors.validation.clear(e),angular.forEach(t,function(e,t){angular.forEach(e,function(e){c.parent.errors.validation.add(t,n.create(e,t))})}),u.reject(c.parent.errors.validation)}var i,s,c=this,u=r.defer();return void 0===e?(i=c.data.attributes,s=c.schema.attributes):(i={},s={},i[e]=c.data.attributes[e],s[e]=c.schema.attributes[e]),t.async(i,s).then(a,o),u.promise}function l(n,t){var a=this;return r.resolve(e.link(a,n,t,!0))}function d(n,t){var a=this;return r.resolve(e.unlink(a,n,t,!0))}return o.prototype.save=s,o.prototype.reset=c,o.prototype.validate=u,o.prototype.link=l,o.prototype.unlink=d,o.prototype.toJson=i,{create:a}}angular.module("angular-jsonapi").factory("AngularJsonAPIModelForm",n),n.$inject=["AngularJsonAPIModelValidationError","AngularJsonAPIModelLinkerService","validateJS","$q"]}(),function(){"use strict";function n(){function n(n,t,r,a){return new e(n,t,r,a)}function e(n,e,t,r){var a=this;Error.captureStackTrace(a,a.constructor),a.message=n,a.context={synchronization:e,code:t,action:r}}return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e.prototype.name="SynchronizationError",{create:n}}angular.module("angular-jsonapi").factory("AngularJsonAPIModelSynchronizationError",n)}(),function(){"use strict";function n(n,o,i,s,c,u,l,d,h){function p(e,t,r){var a=this;e.relationships=e.relationships||{},a["new"]=void 0===t["new"]?!1:t["new"],a.stable=void 0===t.stable?!0:t.stable,a["synchronized"]=void 0===t["synchronized"]?!0:t["synchronized"],a.pristine=void 0===t.pristine?!0:t.pristine,a.removed=!1,a.loading=!1,a.saving=!1,a.updatedAt=a["synchronized"]===!0?Date.now():r,a.loadingCount=0,a.savingCount=0,a.data={relationships:{},attributes:{}},a.relationships={},angular.forEach(a.schema.relationships,function(n,e){a.relationships[e]=void 0}),a.errors={validation:i.create("Validation","Errors of attributes validation",o),synchronization:i.create("Synchronization","Errors of synchronizations",n)},a.promises={},I(a,e),a.form=c.create(a)}function f(){function n(){i.synchronize(c).then(e,t,o)}function e(n){u.$emit("angularJsonAPI:"+i.data.type+":object:"+c.action,"resolved",i,n),i.update(i.form.data),i["new"]===!0&&(i.resource.cache.indexIds=i.resource.cache.indexIds||[],i.resource.cache.indexIds.push(i.data.id)),i["synchronized"]=!0,i["new"]=!1,i.pristine=!1,i.stable=!0,n.finish(),i.errors.synchronization.concat(n.errors),s.resolve(i)}function t(n){u.$emit("angularJsonAPI:"+i.data.type+":object:save","rejected",i,n),n.finish(),i.errors.synchronization.concat(n.errors),s.reject(i)}function o(n){u.$emit("angularJsonAPI:"+i.data.type+":object:save","notify",i,n),s.notify(n)}var i=this,s=h.defer(),c={action:i["new"]===!0?"add":"update",object:i};return i.form.validate().then(n,s.reject)["finally"](a.bind(i,void 0)),r(i),s.promise}function y(){var n=this;void 0!==n.form&&n.form.reset()}function g(r){function a(n){function r(n){return e(n),n.synchronize({action:"include",object:n})["finally"](t.bind(n,void 0))}function a(n){angular.forEach(n,function(n,e){n.success===!0&&(u.$emit("angularJsonAPI:"+o.included[e].data.type+":object:include","resolved",o.included[e],n),n.value.finish())}),c.resolve(d)}var o=s.__proccesResults(n.data);u.$emit("angularJsonAPI:"+d.data.type+":object:refresh","resolved",d,n),h.allSettled(o.included.map(r)).then(a,c.reject),d["synchronized"]=!0,d.stable=!0,d.pristine=!1,n.finish(),d.errors.synchronization.concat(n.errors)}function o(n){u.$emit("angularJsonAPI:"+d.data.type+":object:refresh","rejected",d,n),n.finish(),d.errors.synchronization.concat(n.errors),c.reject(d)}function i(n){u.$emit("angularJsonAPI:"+d.data.type+":object:refresh","notify",d,n),c.notify(n)}var s=l.get("$jsonapi"),c=h.defer(),d=this;r=void 0===r?d.schema.params.get:r;var p={action:"refresh",object:d,params:r};if(d["new"]===!0){var f=n.create("Can't refresh new object",null,0,"refresh");d.errors.synchronization.add("refresh",f),c.reject(f)}else e(d),d.synchronize(p).then(a,o,i)["finally"](t.bind(d,void 0));return c.promise}function v(){var n=this,e=angular.copy(n.data),t={};return angular.forEach(e.relationships,function(n,e){void 0!==n.data&&(t[e]=n)}),e.relationships=t,{data:e,updatedAt:n.updatedAt}}function m(){function n(n){u.$emit("angularJsonAPI:"+o.data.type+":object:remove","resolved",o,n),o.removed=!0,o.unlinkAll(),o.resource.cache.clearRemoved(o.data.id),n.finish(),o.errors.synchronization.concat(n.errors),i.resolve(o)}function e(n){u.$emit("angularJsonAPI:"+o.data.type+":object:remove","rejected",o,n),o.resource.cache.revertRemove(o.data.id),n.finish(),o.errors.synchronization.concat(n.errors),i.reject(o)}function t(n){u.$emit("angularJsonAPI:"+o.data.type+":object:remove","notify",o,n),i.notify(n)}var o=this,i=h.defer(),s={action:"remove",object:o};return o.resource.cache.remove(o.data.id),o["new"]===!0?i.resolve():(r(o),o.synchronize(s).then(n,e,t)["finally"](a.bind(o,void 0))),i.promise}function b(n){function r(n,e){var t=o.schema.relationships[e],r=t.reflection;angular.isArray(n)?angular.forEach(n,a.bind(void 0,r)):angular.isObject(n)&&a(r,n),"hasOne"===t.type?o.relationships[e]=null:"hasMany"===t.type&&(o.relationships[e]=[])}function a(n,r){function a(n){u.$emit("angularJsonAPI:"+o.data.type+":object:unlinkReflection","resolve",o,n),n.finish(),o.errors.synchronization.concat(n.errors),i.resolve(o)}function c(n){u.$emit("angularJsonAPI:"+o.data.type+":object:unlinkReflection","rejected",o,n),n.finish(),o.errors.synchronization.concat(n.errors),i.reject(o)}function l(n){u.$emit("angularJsonAPI:"+o.data.type+":object:unlinkReflection","notify",o,n),n.finish(),i.notify(n)}var d=r.schema.relationships[n],h={action:"unlinkReflection",object:r,target:o,key:n};e(r),s.unlink(r,n,o,d),r.synchronize(h).then(a,c,l)["finally"](t.bind(r,void 0))}var o=this,i=h.defer();return e(o),void 0===n?angular.forEach(o.relationships,r):r(o.relationships[n],n),t(o),i.promise}function j(o,i){function c(n){function r(n){return e(i),i.synchronize({action:"linkReflection",object:n.object,target:n.target,key:n.key})["finally"](t.bind(i,void 0))}function a(n){angular.forEach(n,function(n,e){n.success===!0&&(u.$emit("angularJsonAPI:"+c[e].object.data.type+":object:linkReflection","resolved",c[e],n),n.value.finish())}),f.resolve(y)}u.$emit("angularJsonAPI:"+y.data.type+":object:link","resolved",y,n);var c=s.link(y,o,i);y.stable=!0,y.pristine=!1,n.finish(),y.errors.synchronization.concat(n.errors),h.allSettled(c.map(r)).then(a,f.reject)}function l(n){u.$emit("angularJsonAPI:"+y.data.type+":object:link","rejected",y,n),f.reject(n.errors),n.finish(),y.errors.synchronization.concat(n.errors),f.reject(y)}function d(n){u.$emit("angularJsonAPI:"+y.data.type+":object:link","notify",y,n),f.notify(n)}var p,f=h.defer(),y=this,g={action:"link",object:y,target:i,key:o};return void 0===i?(p=n.create("Can't link undefined",null,0,"link"),y.errors.synchronization.add("link",p),f.reject(p)):y["new"]===!0?(p=n.create("Can't link new object",null,0,"link"),y.errors.synchronization.add("link",p),f.reject(p)):(r(y),y.synchronize(g).then(c,l,d)["finally"](a.bind(y,void 0))),f.promise}function A(o,i){function c(n){function r(n){return e(i),i.synchronize({action:"unlinkReflection",object:n.object,target:n.target,key:n.key})["finally"](t.bind(i,void 0))}function a(n){angular.forEach(n,function(e){e.success===!0&&(u.$emit("angularJsonAPI:"+c[o].data.type+":object:unlinkReflection","resolved",c[o],e),n.value.finish())}),f.resolve(y)}u.$emit("angularJsonAPI:"+y.data.type+":object:unlink","resolved",y,n);var c=s.link(y,o,i);y.stable=!0,y.pristine=!1,n.finish(),y.errors.synchronization.concat(n.errors),h.allSettled(c.map(r)).then(a,f.reject)}function l(n){u.$emit("angularJsonAPI:"+y.data.type+":object:unlink","rejected",y,n),f.reject(n.errors),n.finish(),y.errors.synchronization.concat(n.errors),f.reject(y)}function d(n){u.$emit("angularJsonAPI:"+y.data.type+":object:unlink","notify",y,n),f.notify(n)}var p,f=h.defer(),y=this,g={action:"unlink",object:y,target:i,key:o};return void 0===i?(p=n.create("Can't unlink undefined",null,0,"unlink"),y.errors.synchronization.add("unlink",p),f.reject(y)):y["new"]===!0?(p=n.create("Can't unlink new object",null,0,"unlink"),y.errors.synchronization.add("unlink",p),f.reject(y)):(r(y),y.synchronize(g).then(c,l,d)["finally"](a.bind(y,void 0))),f.promise}function k(n,r,a){var o=this;e(o),I(o,n),o.reset(r),o["synchronized"]=a===!0?!1:!0,o.stable=a===!0?!1:!0,o.updatedAt=Date.now(),t(o)}function z(){var n=this,e=!1;return angular.forEach(n.errors,function(n){e=n.hasErrors()||e}),e}function I(n,e){function t(t,r){n.data.attributes[r]=e.attributes[r]}function r(t,r){var i=e.relationships[r];return void 0===i?void(n.data.relationships[r]={data:void 0}):(n.data.relationships[r]=n.data.relationships[r]||{},n.data.relationships[r].links=i.links,void("hasOne"===t.type?a(n,r,i.data):"hasMany"===t.type&&angular.isArray(i.data)&&(0===i.data.length?(n.data.relationships[r].data=[],n.unlinkAll(r)):(angular.forEach(n.relationships[r],o.bind(void 0,n,r,i.data)),angular.forEach(i.data,a.bind(void 0,n,r))))))}function a(n,e,t){var r;if(null===t)return void s.link(n,e,null);if(void 0!==t){if(r=i.getResource(t.type),void 0===r)return void d.error("Factory not found",t.type,t);var a=r.cache.get(t.id);s.link(n,e,a)}}function o(n,e,t,r){t.indexOf(r.data.id)>-1||s.unlink(n,e,r)}var i=l.get("$jsonapi"),c=n.schema;return n.data.id=e.id,n.data.type=e.type,n.resource.schema.type!==e.type?(d.error("Different type then resource",n.resource.schema.type,e),!1):angular.isString(n.data.id)?(e.attributes=e.attributes||{},e.relationships=e.relationships||{},angular.forEach(c.attributes,t),angular.forEach(c.relationships,r),!0):(d.error(n.data.id+" - Invalid id"),!1)}return p.prototype.refresh=g,p.prototype.remove=m,p.prototype.reset=y,p.prototype.save=f,p.prototype.update=k,p.prototype.link=j,p.prototype.unlink=A,p.prototype.unlinkAll=b,p.prototype.toJson=v,p.prototype.hasErrors=z,p}function e(n){n=void 0===n?this:n,n.loadingCount+=1,n.loading=!0}function t(n){n=void 0===n?this:n,n.loadingCount-=1,n.loading=n.loadingCount>0}function r(n){n=void 0===n?this:n,n.savingCount+=1,n.saving=!0}function a(n){n=void 0===n?this:n,n.savingCount-=1,n.saving=n.savingCount>0}angular.module("angular-jsonapi").factory("AngularJsonAPIAbstractModel",n),n.$inject=["AngularJsonAPIModelSynchronizationError","AngularJsonAPIModelValidationError","AngularJsonAPIModelErrorsManager","AngularJsonAPIModelLinkerService","AngularJsonAPIModelForm","$rootScope","$injector","$log","$q"]}(),function(){"use strict";function n(){function n(n,t){return new e(n,t)}function e(n,e){var t=this;Error.captureStackTrace(t,t.constructor),t.message=n,t.context={attribute:e}}return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e.prototype.name="ValidationError",{create:n}}angular.module("angular-jsonapi").factory("AngularJsonAPIModelValidationError",n)}(),function(){"use strict";function n(){function n(n,t,r,a){return new e(n,t,r,a)}function e(n,e,t,r){var a=this;a.name=n,a.description=e,a.ErrorConstructor=t,a.errors={},a.defaultFilter=r||function(){return!0}}function t(n){var e=this;void 0===n?angular.forEach(e.errors,function(n,t){e.errors[t]=[]}):e.errors[n]=[]}function r(n,e){var t=this;t.errors[n]=t.errors[n]||[],t.errors[n].push(e)}function a(n){var e=this;angular.forEach(n,function(n){e.errors[n.key]=[]}),angular.forEach(n,function(n){e.errors[n.key].push(n.object)})}function o(n){var e=this;if(void 0===n){var t=!1;return angular.forEach(e.errors,function(n){t=t||n.length>0}),t}return void 0!==e.errors[n]&&e.errors[n].length>0}return e.prototype.constructor=e,e.prototype.concat=a,e.prototype.clear=t,e.prototype.add=r,e.prototype.hasErrors=o,{create:n}}angular.module("angular-jsonapi").factory("AngularJsonAPIModelErrorsManager",n)}(),function(){"use strict";angular.module("angular-jsonapi").constant("lazyProperty",function(n,e,t){var r,a;Object.defineProperty(n,e,{get:function(){return a||(a=!0,r=t.call(n)),r},enumerable:!0,configurable:!0})})}(),function(){"use strict";angular.module("angular-jsonapi").constant("toKebabCase",function(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()})}(),function(){"use strict";angular.module("angular-jsonapi").config(["$provide",function(n){n.decorator("$q",["$delegate",function(n){var e=n;return e.allSettled=e.allSettled||function(n,t,r){function a(n){return e.resolve(n).then(function(n){return angular.isFunction(t)&&t(n),{success:!0,value:n}},function(n){return angular.isFunction(r)&&r(n),{success:!1,reason:n}})}var o=angular.isArray(n)?[]:{};return angular.forEach(n,function(n,e){o.hasOwnProperty(e)||(o[e]=a(n))}),e.all(o)},e}])}])}(),function(){"use strict";function n(n,e,t){function r(n){return new a(n)}function a(e){var t=this;t.state={},n.call(t,e),angular.forEach(e,function(n){n.synchronizer=t})}function o(r){function a(n){d.notify({step:"synchronization",data:n})}function o(n){d.notify({step:"synchronization",errors:n})}function i(n){u.state[h]=u.state[h]||{},u.state[h].success=!0,angular.forEach(n,function(n){n.success===!1&&(u.state[h].success=!1)}),angular.forEach(u.synchronizations,function(e){angular.forEach(e.afterHooks[h],function(e){d.notify({step:"after",errors:e.call(u,r,n)})})});var e,t=[];angular.forEach(n,function(n){n.success===!0?e=n.value:t.push({key:h,object:n.reason})}),t.length>0?d.reject({data:e,finish:s,errors:t}):d.resolve({data:e,finish:s,errors:t})}function s(){angular.forEach(u.synchronizations,function(n){angular.forEach(n.finishHooks[h],function(n){d.notify({step:"finish",errors:n.call(u,r)})})})}function c(n){t.error("All settled rejected! Something went wrong"),d.reject({finish:angular.noop,errors:n})}var u=this,l=[],d=e.defer(),h=r.action;return n.prototype.synchronize.call(u,r),angular.forEach(u.synchronizations,function(n){angular.forEach(n.beginHooks[h],function(n){d.notify({step:"begin",data:n.call(u,r)})})}),angular.forEach(u.synchronizations,function(n){angular.forEach(n.beforeHooks[h],function(n){d.notify({step:"before",data:n.call(u,r)})})}),angular.forEach(u.synchronizations,function(n){angular.forEach(n.synchronizationHooks[h],function(n){l.push(n.call(u,r))})}),e.allSettled(l,a,o).then(i,c),d.promise}return a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype.synchronize=o,{create:r}}angular.module("angular-jsonapi").factory("AngularJsonAPISynchronizerSimple",n),n.$inject=["AngularJsonAPISynchronizerPrototype","$q","$log"]}(),function(){"use strict";function n(n){function e(n){var e=this;e.synchronizations=n}function t(e){var t=this;n.debug("Synchro Collection",t.resource.schema.type,e),void 0===e.action&&n.error("Can't synchronize undefined action",e)}return e.prototype.synchronize=t,e}angular.module("angular-jsonapi").factory("AngularJsonAPISynchronizerPrototype",n),n.$inject=["$log"]}(),function(){"use strict";function n(n,e,t,r,a,o){function i(n,e){return new s(n,e)}function s(r,i){function s(n){return o({method:"GET",headers:v,url:i,params:n.params||{}}).then(f,y.bind(null,"all"))}function c(n){return o({method:"GET",headers:v,url:i+"/"+n.object.data.id,params:n.params||{}}).then(f,y.bind(null,"get"))}function u(n){return o({method:"DELETE",headers:v,url:i+"/"+n.object.data.id}).then(f,y.bind(null,"remove"))}function l(e){var t=a.defer(),r=e.object.schema.relationships[e.key];return e.object.removed===!0?t.reject(n.create("Object has been removed",g,0,"unlink")):void 0!==e.target&&void 0===e.target.data.id?t.reject(n.create("Can't unlink object without id through rest call",g,0,"unlink")):"hasOne"===r.type?o({method:"DELETE",headers:v,url:i+"/"+e.object.data.id+"/relationships/"+e.key}).then(f,y.bind(null,"get")).then(t.resolve,t.reject):"hasMany"===r.type&&(void 0===e.target?o({method:"PUT",headers:v,data:{data:[]},url:i+"/"+e.object.data.id+"/relationships/"+e.key}).then(f,y.bind(null,"unlink")).then(t.resolve,t.reject):o({method:"DELETE",headers:v,url:i+"/"+e.object.data.id+"/relationships/"+e.key+"/"+e.target.data.id}).then(f,y.bind(null,"unlink")).then(t.resolve,t.reject)),t.promise}function d(n){var e=a.defer(),r=n.object.schema.relationships[n.key];return n.object.removed===!0?e.reject({errors:[{status:0,statusText:"Object has been removed"}]}):void 0===n.target||void 0===n.target.data.id?e.reject({errors:[{status:0,statusText:"Can't link object without id through rest call"}]}):"hasOne"===r.type?o({method:"PUT",headers:v,data:{data:t.toLinkData(n.target)},url:i+"/"+n.object.data.id+"/relationships/"+n.key}).then(f,y.bind(null,"link")).then(e.resolve,e.reject):"hasMany"===r.type&&o({method:"POST",headers:v,data:{data:[t.toLinkData(n.target)]},url:i+"/"+n.object.data.id+"/relationships/"+n.key}).then(f,y.bind(null,"link")).then(e.resolve,e.reject),e.promise}function h(n){return o({method:"PUT",headers:v,url:i+"/"+n.object.data.id,data:n.object.form.toJson()}).then(f,y.bind(null,"update"))}function p(n){return o({method:"POST",headers:v,url:i+"/",data:n.object.form.toJson()}).then(f,y.bind(null,"add"))}function f(n){return a.resolve(n.data)}function y(e,t){function r(t){s.reject(n.create("Server is offline",g,t.status,e))}function i(){s.reject(n.create("No internet connection",g,t.status,e))}var s=a.defer();return 0===t.status?o({method:"GET",url:"https://status.cloud.google.com/incidents.schema.json"}).then(r,i):s.reject(n.create(t.statusText,g,t.status,e)),s.promise}var g=this,v={Accept:"application/vnd.api+json","Content-Type":"application/vnd.api+json"};e.apply(g,arguments),g.synchronization("remove",u),g.synchronization("unlink",l),g.synchronization("link",d),g.synchronization("update",h),g.synchronization("add",p),g.synchronization("all",s),g.synchronization("get",c),g.synchronization("refresh",c)}return s.prototype=Object.create(e.prototype),s.prototype.constructor=s,{create:i}}angular.module("angular-jsonapi-rest",["angular-jsonapi"]).factory("AngularJsonAPISynchronizationRest",n),n.$inject=["AngularJsonAPIModelSynchronizationError","AngularJsonAPISynchronizationPrototype","AngularJsonAPIModelLinkerService","toKebabCase","$q","$http"]}(),function(){"use strict";function n(){function n(n){var e=this,t=["add","init","get","all","clearCache","remove","unlink","unlinkReflection","link","linkReflection","update","refresh","include"];e.name=n,e.state={},e.beginHooks={},e.beforeHooks={},e.synchronizationHooks={},e.afterHooks={},e.finishHooks={},e.options={},angular.forEach(t,function(n){e.beginHooks[n]=[],e.beforeHooks[n]=[],e.synchronizationHooks[n]=[],e.afterHooks[n]=[],e.finishHooks[n]=[],e.state[n]={loading:!1,success:!0}})}function e(n,e){var t=this;t.beginHooks[n].push(e)}function t(n,e){var t=this;t.finishHooks[n].push(e)}function r(n,e){var t=this;t.beforeHooks[n].push(e)}function a(n,e){var t=this;t.afterHooks[n].push(e)}function o(n,e){var t=this;t.synchronizationHooks[n].push(e)}return n.prototype.before=r,n.prototype.after=a,n.prototype.begin=e,n.prototype.finish=t,n.prototype.synchronization=o,n}angular.module("angular-jsonapi").factory("AngularJsonAPISynchronizationPrototype",n)}(),function(){"use strict";function n(n,e,t){function r(n,e){return new a(n,e)}function a(r,a){function o(){var n=c.synchronizer.resource.schema.type;return t.resolve(e.localStorage.getItem(a+"."+n))}function i(){var n=c.synchronizer.resource.schema.type;e.localStorage.removeItem(a+"."+n)}function s(){var n=c.synchronizer.resource.schema.type,t=c.synchronizer.resource.cache;e.localStorage.setItem(a+"."+n,t.toJson())}var c=this;a=a||"AngularJsonAPI",c.__updateStorage=s,n.apply(c,arguments),c.synchronization("init",o),c.begin("clearCache",i),c.begin("remove",s),c.begin("refresh",s),c.begin("unlink",s),c.begin("unlinkReflection",s),c.begin("link",s),c.begin("linkReflection",s),c.begin("update",s),c.begin("add",s),c.begin("get",s),c.begin("all",s),c.begin("include",s),c.finish("init",s),c.finish("clearCache",s),c.finish("remove",s),c.finish("refresh",s),c.finish("unlink",s),c.finish("unlinkReflection",s),c.finish("link",s),c.finish("linkReflection",s),c.finish("update",s),c.finish("add",s),c.finish("get",s),c.finish("all",s),c.finish("include",s)}return a.prototype=Object.create(n.prototype),a.prototype.constructor=a,{create:r}}angular.module("angular-jsonapi-local",["angular-jsonapi"]).factory("AngularJsonAPISynchronizationLocal",n),n.$inject=["AngularJsonAPISynchronizationPrototype","$window","$q"]}(),function(){"use strict";function n(n,e,t){function r(n){return new a(n)}function a(n){var e=this,r=n.include||{};n.include=r,r.get=n.include.get||[],r.all=n.include.all||[],e.params={get:{},all:{}},angular.forEach(n.relationships,function(e,a){var o=t.create(e,a,n.type);n.relationships[a]=o,o.included===!0&&(r.get.push(a),"hasOne"===o.type&&r.all.push(a))}),angular.extend(e,n),r.get.length>0&&(e.params.get.include=r.get.join(",")),r.all.length>0&&(e.params.all.include=r.all.join(","))}return{create:r}}angular.module("angular-jsonapi").factory("AngularJsonAPISchema",n),n.$inject=["$log","pluralize","AngularJsonAPISchemaLink"]}(),function(){"use strict";function n(n,e){function t(n,e,t){return new r(n,e,t)}function r(t,r,a){var o=this;angular.isString(t)?(o.model=e.plural(r),o.type=t,o.polymorphic=!1,o.reflection=a):(void 0===t.type&&n.error("Schema of link without a type: ",t,r),"hasMany"!==t.type&&"hasOne"!==t.type&&n.error("Schema of link with wrong type: ",t.type,"available: hasOne, hasMany"),o.model=t.model||e.plural(r),o.type=t.type,o.polymorphic=t.polymorphic||!1,void 0===t.reflection?o.reflection="hasMany"===o.type?e.singular(a):a:o.reflection=t.reflection,o.included=t.included||!1)}return{create:t}}angular.module("angular-jsonapi").factory("AngularJsonAPISchemaLink",n),n.$inject=["$log","pluralize"]}(),function(){"use strict";function n(n,e,t,r,a,o,i,s){function c(n,e){return new u(n,e)}function u(r,a){function i(n){o.$emit("angularJsonAPI:"+u.type+":resource:init","resolved",n),u.cache.fromJson(n.data),u.initialized=!0,n.finish()}function s(n){o.$emit("angularJsonAPI:"+u.type+":resource:init","rejected",n),n.finish(),u.initialized=!0}function c(n){o.$emit("angularJsonAPI:"+u.type+":resource:init","notify",n)}var u=this,l={action:"init"};u.schema=e.create(r),u.cache=t.create(u),u.synchronizer=a,u.synchronizer.resource=u,u.modelFactory=n.modelFactory(u.schema,u),u.initialized=!1,u.type=u.schema.type,a.resource=u,u.synchronizer.synchronize(l).then(i,s,c)}function l(n,e){var t=this;if(!angular.isString(n))return s.reject({errors:[{status:0,statusText:"ID must be a string"}]});var r=t.cache.get(n);return r.refresh(e),r}function d(n){var e=this;n=void 0===n?e.schema.params.all:n;var t=r.create(e,n);return t.$promise=t.fetch(),t}function h(n){var e=this,t=e.cache.remove(n);return t.remove()}function p(){var n=this,e={};angular.forEach(n.schema.relationships,function(n,t){"hasOne"===n.type?e[t]={data:null}:"hasMany"===n.type&&(e[t]={data:[]})});var t={type:n.type,id:a.generate(),attributes:{},relationships:e},r={"new":!0,"synchronized":!1,stable:!1,pristine:!1,initialization:!1},i=n.cache.addOrUpdate(t,r);return o.$emit("angularJsonAPI:"+n.type+":resource:initialize","resolved",i),i}function f(){function n(n){o.$emit("angularJsonAPI:"+r.type+":resource:clearCache","resolved",n),n.finish(),a.resolve(n)}function e(n){o.$emit("angularJsonAPI:"+r.type+":resource:clearCache","resolved",n),n.finish(),a.reject(n)}function t(n){o.$emit("angularJsonAPI:"+r.type+":resource:clearCache","notify",n),a.notify(n)}var r=this,a=s.defer(),i={action:"clearCache"};return r.cache.clear(),r.synchronizer.synchronize(i).then(n,e,t),a}return u.prototype.get=l,u.prototype.all=d,u.prototype.remove=h,u.prototype.initialize=p,u.prototype.clearCache=f,{create:c}}angular.module("angular-jsonapi").factory("AngularJsonAPIResource",n),n.$inject=["AngularJsonAPIModel","AngularJsonAPISchema","AngularJsonAPIResourceCache","AngularJsonAPICollection","uuid4","$rootScope","$log","$q"]}(),function(){"use strict";function n(n,e,t){function r(e,r){function a(n,e,t){return new o(n,e,t)}var o=function(e,r,a){var o=this;e.type!==o.schema.type&&t.error("Data type other then declared in schema: ",e.type," instead of ",o.schema.type),n.call(o,e,r,a),o.form.parent=o};return o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.schema=e,o.prototype.resource=r,o.prototype.synchronize=r.synchronizer.synchronize.bind(r.synchronizer),angular.forEach(e.functions,function(n,e){o.prototype[e]=function(){return n.apply(this,arguments)}}),a}return{modelFactory:r}}angular.module("angular-jsonapi").factory("AngularJsonAPIModel",n),n.$inject=["AngularJsonAPIAbstractModel","AngularJsonAPISchema","$log"]}(),function(){"use strict";function n(n,r,a,o,i){function s(n,e){return new c(n,e)}function c(e,t){function o(n,e,t){var r;"resolved"===e&&void 0!==u.data&&(r=u.data.indexOf(t),r>-1&&(u.data.splice(r,1),u.resource.cache.setIndexIds(u.data)))}function i(){u.data=void 0,u.pristine=!0}function s(n,e,t){"resolved"===e&&(u.data=u.data||[],u.data.push(t))}function c(){l(),d(),h()}var u=this;u.resource=e,u.type=e.schema.type,u.params=t,u.errors={synchronization:r.create("Synchronization","Errors of synchronizations",n)
},u.data=u.resource.cache.index(u.params),u.loading=!1,u.loadingCount=0,u["synchronized"]=!1,u.pristine=void 0===u.data;var l=a.$on("angularJsonAPI:"+u.type+":object:remove",o),d=a.$on("angularJsonAPI:"+u.type+":resource:clearCache",i),h=a.$on("angularJsonAPI:"+u.type+":object:add",s);a.$on("$destroy",c)}function u(){var n=this,e=!1;return angular.forEach(n.errors,function(n){e=n.hasErrors()||e}),e}function l(n,e){var t=this;return t.resource.get(n,e)}function d(){function n(n){function r(n){return e(n),n.synchronize({action:"include",object:n})["finally"](t.bind(n,void 0))}function o(n){angular.forEach(n,function(n,e){n.success===!0&&(a.$emit("angularJsonAPI:"+s.included[e].data.type+":object:include","resolved",s.included[e],n),n.value.finish())}),u.resolve(c)}var s=l.__proccesResults(n.data);a.$emit("angularJsonAPI:"+c.type+":collection:fetch","resolved",c,n),i.allSettled(s.included.map(r)).then(o,u.reject),angular.forEach(c.data,t),c.data=s.data,c.updatedAt=Date.now(),c["synchronized"]=!0,c.resource.cache.setIndexIds(c.data),n.finish(),c.errors.synchronization.concat(n.errors),u.resolve(c)}function r(n){a.$emit("angularJsonAPI:"+c.type+":collection:fetch","rejected",c,n),angular.forEach(c.data,t),n.finish(),c.errors.synchronization.concat(n.errors),u.reject(c)}function s(n){a.$emit("angularJsonAPI:"+c.type+":collection:fetch","notify",c,n),u.notify(n)}var c=this,u=i.defer(),l=o.get("$jsonapi"),d={action:"all",params:c.params};return e(c),angular.forEach(c.data,e),c.resource.synchronizer.synchronize(d).then(n,r,s)["finally"](t.bind(c,void 0)),u.promise}return c.prototype.fetch=d,c.prototype.refresh=d,c.prototype.get=l,c.prototype.hasErrors=u,{create:s}}function e(n){n=void 0===n?this:n,n.loadingCount+=1,n.loading=!0}function t(n){n=void 0===n?this:n,n.loadingCount-=1,n.loading=n.loadingCount>0}angular.module("angular-jsonapi").factory("AngularJsonAPICollection",n),n.$inject=["AngularJsonAPIModelSynchronizationError","AngularJsonAPIModelErrorsManager","$rootScope","$injector","$q"]}(),function(){"use strict";function n(n){function e(e,a){function o(n,e){var o=a.create(n,e);t[n.type]=o,r.push(n.type)}function i(n){return t[n]}function s(){return t}function c(){return r}function u(){angular.forEach(t,function(n){n.clearCache()})}function l(t,r){return angular.isString(t)?(void 0===n.validators[t]&&e.warn("Redeclaring validator",t),void(n.validators[t]=r)):void e.error("Validator name is not a string",t)}function d(n){var t={data:[],included:[]};void 0===n&&e.error("Can't proccess results:",n);var r={"new":!1,"synchronized":!0,stable:!0,pristine:!1,initialization:!1};return angular.forEach(n.included,function(n){t.included.push(i(n.type).cache.addOrUpdate(n,r))}),angular.isArray(n.data)?angular.forEach(n.data,function(n){t.data.push(i(n.type).cache.addOrUpdate(n,r))}):t.data.push(i(n.data.type).cache.addOrUpdate(n.data,r)),t}return{addResource:o,getResource:i,clearCache:u,allResources:s,listResources:c,addValidator:l,__proccesResults:d}}var t={},r=[];this.$get=e,e.$inject=["$log","AngularJsonAPIResource"]}angular.module("angular-jsonapi").provider("$jsonapi",n),n.$inject=["validateJS"]}(),function(){"use strict";angular.module("angular-jsonapi").config(["$logProvider",function(n){n.debugEnabled(!1)}]).run(["validateJS","$q",function(n,e){n.Promise=e}])}();
//# sourceMappingURL=angular-jsonapi.min.js.map